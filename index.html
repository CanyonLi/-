<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æƒ…ä¾£ä»»åŠ¡ç®¡ç†å™¨ - é«˜çº§ç‰ˆ</title>
  <!-- å¼•å…¥ TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- å¼•å…¥ GSAP åŠ¨ç”»åº“ CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
  <!-- å¼•å…¥ Vue3 å…¨å±€æ„å»ºç‰ˆæœ¬ CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- å¼•å…¥ Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>

  <style>
    /* 
      1. èƒŒæ™¯ä½¿ç”¨ xiaomao.pngï¼Œä¸å¯ç§»åŠ¨ï¼Œå±…ä¸­å¹¶ä¿æŒæ¯”ä¾‹ç¼©æ”¾ 
      2. é¢„ç•™çº¯è‰²ä½œä¸ºèƒŒæ™¯è‰²ï¼Œè‹¥å›¾ç‰‡å°ºå¯¸ä¸å¤Ÿå¤§æ—¶ä½œä¸ºå¡«å……
    */
    body {
      margin: 0;
      padding: 0;
      background: #1b1b1b url("xiaomao.png") no-repeat center center fixed;
      background-size: contain; /* åŒæ¯”ä¾‹ç¼©æ”¾ */
      color: #f2f2f2;           /* ä¸»ä½“æ–‡å­—é¢œè‰² */
      font-family: "Microsoft YaHei", sans-serif;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }

    /* 2. è®©ä¸¤ä¸ªæ–¹æ¡†å±…ä¸­æ˜¾ç¤ºï¼šå°å±æ—¶ä¸Šä¸‹å †å ï¼Œå¤§å±æ—¶å·¦å³å¹¶æ’ */
    .columns-container {
      @apply flex justify-center items-start flex-col md:flex-row gap-4;
    }

    /* ä¸¤åˆ—ä»»åŠ¡åŒºåŸŸé‡‡ç”¨åŠé€æ˜æ·±è‰²åŒºåˆ† */
    .column {
      background-color: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      width: 100%;
      max-width: 600px;
    }

    /* æ ‡é¢˜é¢œè‰²åŒºåˆ† */
    .dog-title {
      color: #FFD700; /* é‡‘è‰² */
    }
    .cat-title {
      color: #87CEEB; /* å¤©è“è‰² */
    }

    /* ä»»åŠ¡å¡ç‰‡æ ·å¼ */
    .task-card {
      background-color: #2a2a2a;
      border-radius: 8px;
      padding: 12px;
      margin: 8px 0;
      position: relative;
      color: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }
    .dog-task {
      border-left: 6px solid #FFD700;
    }
    .cat-task {
      border-left: 6px solid #87CEEB;
    }
    /* ä¼˜å…ˆçº§å‘å…‰æ•ˆæœ */
    .priority-high {
      box-shadow: 0 0 8px rgba(255,0,0,0.8);
    }
    .priority-medium {
      box-shadow: 0 0 8px rgba(255,165,0,0.8);
    }
    .priority-low {
      box-shadow: 0 0 8px rgba(0,128,0,0.8);
    }
    /* æ ‡ç­¾æ ·å¼ */
    .tag {
      display: inline-block;
      background: #444;
      color: #fff;
      border-radius: 4px;
      padding: 2px 6px;
      margin-right: 4px;
      font-size: 0.8em;
    }
    /* ä»»åŠ¡å¡ç‰‡èƒŒæ™¯å›¾ç‰‡å¤„ç† */
    .task-card[style*="background-image"] {
      background-size: cover;
      background-position: center;
      text-shadow: 0 0 5px rgba(0,0,0,0.5);
    }

    /* 3. è¾“å…¥æ¡†æ–‡å­—é¢œè‰²æ”¹ä¸ºä¸ã€Œä»»åŠ¡åç§°ã€ç±»ä¼¼çš„ç°è‰² #ccc */
    input[type="text"],
    input[type="date"],
    input[type="datetime-local"],
    textarea {
      background-color: #ffffff;
      color: #ccc; /* æ”¹ä¸ºç°è‰² */
    }
    /* placeholder ä¹Ÿè®¾ä¸ºåŒæ ·çš„ç°è‰² */
    ::placeholder {
      color: #ccc;
    }

    /* å¥–åŠ±æç¤º */
    .reward-popup {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255,215,0,0.9);
      color: #000;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: bold;
      z-index: 1000;
    }

    /* ç®€å• confetti æ ·å¼ */
    .confetti {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      animation: confettiFall 3s linear forwards;
      background: url('https://i.imgur.com/2yaf2wb.png') repeat;
      opacity: 0.8;
      z-index: 999;
    }
    @keyframes confettiFall {
      from { transform: translateY(-100%); }
      to { transform: translateY(100%); }
    }

    /* Emoji é›¨åŠ¨ç”»å®¹å™¨ */
    .effect-rain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2000;
      overflow: hidden;
      display: none; /* é»˜è®¤éšè— */
    }
    /* æ¯ä¸ªä¸‹è½çš„ emoji */
    .rain-item {
      position: absolute;
      font-size: 40px;
      animation: fall linear;
    }
    @keyframes fall {
      0% {
        transform: translateY(-100%) rotate(0deg);
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
      }
    }
  </style>
</head>
<body>
  <!-- ç¤ºä¾‹éŸ³æ•ˆï¼ˆæ›¿æ¢ä¸ºç‹—å«/çŒ«å«å³å¯ï¼‰ -->
  <audio id="dogSound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" preload="auto"></audio>
  <audio id="catSound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" preload="auto"></audio>

  <div id="app" class="container">
    <!-- å…¨å±€æ—¥æœŸé€‰æ‹©å™¨ï¼ˆå†å²æµè§ˆï¼‰ -->
    <div class="mb-4 text-center">
      <label class="text-lg font-semibold">å½“å‰æŸ¥çœ‹æ—¥æœŸï¼š</label>
      <input type="date" v-model="selectedDate" class="p-2 border rounded" />
    </div>

    <!-- ç§¯åˆ†æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="mb-4 text-center">
      <span class="text-xl">æƒ…ä¾£ç§¯åˆ†ï¼š{{ totalPoints }} åˆ†</span>
    </div>

    <!-- AI ä»»åŠ¡æ¨è -->
    <div class="mb-4 text-center">
      <p class="text-lg">AI æ¨è: {{ taskRecommendation }}</p>
    </div>

    <!-- åˆ†æ ä»»åŠ¡åŒºï¼ˆå±…ä¸­æ˜¾ç¤ºï¼‰ -->
    <div class="columns-container">
      <!-- å°ç‹—ä»»åŠ¡åŒº -->
      <div ref="dogColumn" class="column">
        <h2 class="text-xl font-bold mb-3 dog-title">ğŸ¶ å°ç‹—çš„ä»»åŠ¡</h2>
        <div v-for="task in filteredTasks('dog')" :key="task.id" 
             :class="['task-card', 'dog-task', priorityClass(task.priority)]"
             :style="task.backgroundUrl ? { backgroundImage: 'url(' + task.backgroundUrl + ')' } : {}">
          <div class="flex justify-between">
            <span class="font-medium" :class="{ 'line-through text-gray-400': task.completed }">
              {{ task.title }}
            </span>
            <span v-if="task.priority" class="text-xs font-semibold px-2 py-1 rounded">
              {{ task.priority }}ä¼˜å…ˆ
            </span>
          </div>
          <p class="text-sm">ç±»åˆ«ï¼š{{ task.category }} | æˆªæ­¢ï¼š{{ formatDate(task.dueDate) }}</p>
          <p v-if="task.tags && task.tags.length" class="text-sm">
            æ ‡ç­¾: <span v-for="tag in task.tags" :key="tag" class="tag">{{ tag }}</span>
          </p>
          <button @click="completeTask(task)" class="mt-2 px-2 py-1 bg-yellow-600 text-white rounded" :disabled="task.completed">
            {{ task.completed ? "å·²å®Œæˆ" : "å®Œæˆ" }}
          </button>
          <!-- ä¸Šä¼ èƒŒæ™¯å›¾ç‰‡ -->
          <div class="mt-2">
            <input type="file" @change="uploadBackground(task, $event)" accept="image/*" />
          </div>
        </div>
        <!-- æ·»åŠ ä»»åŠ¡è¡¨å• -->
        <div class="mt-4 border-t pt-4">
          <h3 class="text-lg font-semibold mb-2 dog-title">æ–°å¢ä»»åŠ¡</h3>
          <form @submit.prevent="addTask('dog')">
            <input v-model="newTask.dog.title" type="text" placeholder="ä»»åŠ¡åç§°" class="w-full p-2 border rounded mb-2" required />
            <textarea v-model="newTask.dog.description" placeholder="ä»»åŠ¡æè¿°" class="w-full p-2 border rounded mb-2"></textarea>
            <div class="flex gap-2 mb-2">
              <input v-model="newTask.dog.dueDate" type="datetime-local" class="w-1/2 p-2 border rounded" />
              <input v-model="newTask.dog.tags" type="text" placeholder="æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰" class="w-1/2 p-2 border rounded" />
            </div>
            <div class="flex gap-2 mb-2">
              <select v-model="newTask.dog.category" class="w-1/2 p-2 border rounded">
                <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
                <option value="å·¥ä½œ">å·¥ä½œ</option>
                <option value="çº¦ä¼š">çº¦ä¼š</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <select v-model="newTask.dog.priority" class="w-1/2 p-2 border rounded">
                <option value="">é€‰æ‹©ä¼˜å…ˆçº§</option>
                <option value="é«˜">é«˜</option>
                <option value="ä¸­">ä¸­</option>
                <option value="ä½">ä½</option>
              </select>
            </div>
            <div class="mb-2">
              <button type="submit" class="w-full bg-yellow-500 text-white p-2 rounded hover:bg-yellow-600">æ·»åŠ ä»»åŠ¡</button>
            </div>
            <!-- (1) ç§»é™¤ã€Œè¯­éŸ³æ·»åŠ ä»»åŠ¡ã€æŒ‰é’® -->
          </form>
        </div>
      </div>

      <!-- å°çŒ«ä»»åŠ¡åŒº -->
      <div ref="catColumn" class="column">
        <h2 class="text-xl font-bold mb-3 cat-title">ğŸ± å°çŒ«çš„ä»»åŠ¡</h2>
        <div v-for="task in filteredTasks('cat')" :key="task.id" 
             :class="['task-card', 'cat-task', priorityClass(task.priority)]"
             :style="task.backgroundUrl ? { backgroundImage: 'url(' + task.backgroundUrl + ')' } : {}">
          <div class="flex justify-between">
            <span class="font-medium" :class="{ 'line-through text-gray-400': task.completed }">
              {{ task.title }}
            </span>
            <span v-if="task.priority" class="text-xs font-semibold px-2 py-1 rounded">
              {{ task.priority }}ä¼˜å…ˆ
            </span>
          </div>
          <p class="text-sm">ç±»åˆ«ï¼š{{ task.category }} | æˆªæ­¢ï¼š{{ formatDate(task.dueDate) }}</p>
          <p v-if="task.tags && task.tags.length" class="text-sm">
            æ ‡ç­¾: <span v-for="tag in task.tags" :key="tag" class="tag">{{ tag }}</span>
          </p>
          <button @click="completeTask(task)" class="mt-2 px-2 py-1 bg-blue-600 text-white rounded" :disabled="task.completed">
            {{ task.completed ? "å·²å®Œæˆ" : "å®Œæˆ" }}
          </button>
          <!-- ä¸Šä¼ èƒŒæ™¯å›¾ç‰‡ -->
          <div class="mt-2">
            <input type="file" @change="uploadBackground(task, $event)" accept="image/*" />
          </div>
        </div>
        <!-- æ·»åŠ ä»»åŠ¡è¡¨å• -->
        <div class="mt-4 border-t pt-4">
          <h3 class="text-lg font-semibold mb-2 cat-title">æ–°å¢ä»»åŠ¡</h3>
          <form @submit.prevent="addTask('cat')">
            <input v-model="newTask.cat.title" type="text" placeholder="ä»»åŠ¡åç§°" class="w-full p-2 border rounded mb-2" required />
            <textarea v-model="newTask.cat.description" placeholder="ä»»åŠ¡æè¿°" class="w-full p-2 border rounded mb-2"></textarea>
            <div class="flex gap-2 mb-2">
              <input v-model="newTask.cat.dueDate" type="datetime-local" class="w-1/2 p-2 border rounded" />
              <input v-model="newTask.cat.tags" type="text" placeholder="æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰" class="w-1/2 p-2 border rounded" />
            </div>
            <div class="flex gap-2 mb-2">
              <select v-model="newTask.cat.category" class="w-1/2 p-2 border rounded">
                <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
                <option value="å·¥ä½œ">å·¥ä½œ</option>
                <option value="çº¦ä¼š">çº¦ä¼š</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <select v-model="newTask.cat.priority" class="w-1/2 p-2 border rounded">
                <option value="">é€‰æ‹©ä¼˜å…ˆçº§</option>
                <option value="é«˜">é«˜</option>
                <option value="ä¸­">ä¸­</option>
                <option value="ä½">ä½</option>
              </select>
            </div>
            <div class="mb-2">
              <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">æ·»åŠ ä»»åŠ¡</button>
            </div>
            <!-- (1) ç§»é™¤ã€Œè¯­éŸ³æ·»åŠ ä»»åŠ¡ã€æŒ‰é’® -->
          </form>
        </div>
      </div>
    </div>

    <!-- å¥–åŠ±å¼¹çª— -->
    <div v-if="unlockedReward" class="reward-popup">
      {{ unlockedReward }}
    </div>

    <!-- Emoji é›¨å®¹å™¨ -->
    <div ref="effectRain" class="effect-rain"></div>
  </div>

  <!-- Vue åº”ç”¨é€»è¾‘ -->
  <script>
    const { createApp, ref, onMounted, inject } = Vue;

    createApp({
      data() {
        return {
          // å…¨å±€é€‰æ‹©æ—¥æœŸï¼ˆç”¨äºå†å²æµè§ˆï¼‰
          selectedDate: new Date().toISOString().split('T')[0],
          // ä»»åŠ¡æ•°æ®ï¼ˆå°†åŒæ­¥è‡ª Firebase Firestoreï¼‰
          tasks: [],
          // æ–°ä»»åŠ¡è¡¨å•æ•°æ®ï¼Œåˆ†åˆ«ä¸º dog ä¸ cat
          newTask: {
            dog: {
              title: '',
              description: '',
              dueDate: '',
              tags: '',
              category: 'ç”Ÿæ´»',
              priority: ''
            },
            cat: {
              title: '',
              description: '',
              dueDate: '',
              tags: '',
              category: 'ç”Ÿæ´»',
              priority: ''
            }
          },
          // æƒ…ä¾£ç§¯åˆ†
          totalPoints: 0,
          // å¥–åŠ±æç¤º
          unlockedReward: null,
          // Rainå®¹å™¨
          effectRainEl: null
        };
      },
      methods: {
        // è¿”å›ä»»åŠ¡ä¼˜å…ˆçº§å¯¹åº”çš„ CSS ç±»
        priorityClass(priority) {
          if (priority === 'é«˜') return 'priority-high';
          if (priority === 'ä¸­') return 'priority-medium';
          if (priority === 'ä½') return 'priority-low';
          return '';
        },
        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
        formatDate(dateStr) {
          return dateStr ? new Date(dateStr).toLocaleString() : '';
        },
        // æ ¹æ® selectedDate è¿‡æ»¤ä»»åŠ¡ï¼ˆæ˜¾ç¤ºè¯¥æ—¥æœŸåŠä¹‹å‰æœªå®Œæˆä»»åŠ¡ï¼‰
        filteredTasks(owner) {
          return this.tasks.filter(task => {
            if (task.owner !== owner) return false;
            if (task.dueDate && task.dueDate.split('T')[0] === this.selectedDate) return true;
            if (task.dueDate && task.dueDate.split('T')[0] < this.selectedDate && !task.completed) return true;
            return false;
          });
        },
        // æ·»åŠ ä»»åŠ¡åˆ° Firestore
        addTask(owner) {
          const nt = this.newTask[owner];
          if (!nt.title.trim()) return;
          // å¤„ç†æ ‡ç­¾ï¼Œåˆ†éš”åå»é™¤ç©ºæ ¼
          const tagArr = nt.tags ? nt.tags.split(/[,ï¼Œ]\s*/).filter(t => t.trim()) : [];
          const taskData = {
            title: nt.title,
            description: nt.description,
            dueDate: nt.dueDate ? new Date(nt.dueDate).toISOString() : null,
            tags: tagArr,
            category: nt.category,
            priority: nt.priority,
            owner: owner,
            completed: false
          };
          // æ·»åŠ åˆ° Firestore
          this.db.collection('tasks').add(taskData)
            .catch(err => {
              console.error("æ·»åŠ ä»»åŠ¡åˆ° Firestore å¤±è´¥:", err);
            });
          // æ¸…ç©ºè¡¨å•æ•°æ®
          this.newTask[owner] = { title: '', description: '', dueDate: '', tags: '', category: 'ç”Ÿæ´»', priority: '' };
        },
        // æ ‡è®°ä»»åŠ¡ä¸ºå®Œæˆï¼Œå¹¶æ›´æ–°æƒ…ä¾£ç§¯åˆ†
        completeTask(task) {
          if (task.completed) return;
          this.db.collection('tasks').doc(task.id).update({ completed: true })
            .catch(err => console.error("æ›´æ–°ä»»åŠ¡çŠ¶æ€å¤±è´¥:", err));

          // æ¯å®Œæˆä¸€é¡¹ä»»åŠ¡è®¡ 1 åˆ†
          this.totalPoints += 1;
          this.db.collection('meta').doc('points').set({ value: this.totalPoints });

          this.checkRewards(this.totalPoints);

          // è§¦å‘åŠ¨ç”»å’ŒéŸ³æ•ˆ
          const emoji = task.owner === 'dog' ? 'ğŸ¶' : 'ğŸ±';
          this.triggerCompletionAnimation(task.owner, emoji);
        },
        // å®Œæˆä»»åŠ¡æ—¶è§¦å‘çš„åŠ¨ç”»ï¼šç®€å•å¼¹è·³ + Emojié›¨ + éŸ³æ•ˆ
        triggerCompletionAnimation(owner, emoji) {
          // 1) è§’è½å¼¹è·³
          const container = owner === 'dog' ? this.$refs.dogColumn : this.$refs.catColumn;
          const emojiEl = document.createElement('div');
          emojiEl.textContent = emoji;
          emojiEl.style.position = 'absolute';
          emojiEl.style.bottom = '20px';
          emojiEl.style.right = '20px';
          emojiEl.style.fontSize = '2rem';
          emojiEl.style.opacity = '0';
          container.appendChild(emojiEl);
          gsap.to(emojiEl, {
            y: -80,
            opacity: 1,
            duration: 0.5,
            yoyo: true,
            repeat: 1,
            onComplete: () => {
              container.removeChild(emojiEl);
            }
          });

          // 2) Emojié›¨
          if (owner === 'dog') {
            this.startRainEffect('dog');
            this.playSound('dogSound');
          } else {
            this.startRainEffect('cat');
            this.playSound('catSound');
          }
        },
        // æ’­æ”¾å¯¹åº”éŸ³æ•ˆ
        playSound(soundId) {
          const audio = document.getElementById(soundId);
          if (audio) {
            audio.currentTime = 0; // ä»å¤´æ’­æ”¾
            audio.play().catch(err => console.warn("éŸ³é¢‘æ’­æ”¾è¢«é˜»æ­¢:", err));
          }
        },
        // ç”Ÿæˆã€Œç‹—ç‹—+çƒ­ç‹—ã€æˆ–ã€ŒçŒ«å’ª+å¯¿å¸ã€çš„çº¯ Emoji é›¨
        startRainEffect(type) {
          if (!this.effectRainEl) return;
          this.effectRainEl.style.display = 'block';

          const dogEmojis = ['ğŸ¶', 'ğŸŒ­']; 
          const catEmojis = ['ğŸ±', 'ğŸ£'];

          // ç”Ÿæˆè‹¥å¹²ä¸‹è½å…ƒç´ 
          for (let i = 0; i < 20; i++) {
            const item = document.createElement('div');
            item.className = 'rain-item';
            // æ ¹æ®ç±»å‹éšæœºå–ç‹—ç‹—/çƒ­ç‹— æˆ– çŒ«å’ª/å¯¿å¸
            if (type === 'dog') {
              item.innerText = dogEmojis[Math.floor(Math.random() * dogEmojis.length)];
            } else {
              item.innerText = catEmojis[Math.floor(Math.random() * catEmojis.length)];
            }
            item.style.left = Math.random() * 100 + '%';
            item.style.animationDuration = 2 + Math.random() * 3 + 's'; // éšæœºä¸‹è½é€Ÿåº¦
            this.effectRainEl.appendChild(item);

            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            item.addEventListener('animationend', () => {
              if (item.parentNode) {
                item.parentNode.removeChild(item);
              }
            });
          }

          // å‡ ç§’åè‡ªåŠ¨éšè—å®¹å™¨
          setTimeout(() => {
            this.effectRainEl.style.display = 'none';
          }, 4000);
        },
        // ä¸Šä¼ ä»»åŠ¡èƒŒæ™¯å›¾ç‰‡
        uploadBackground(task, event) {
          const file = event.target.files[0];
          if (!file) return;
          const storageRef = this.storage.ref(`task-backgrounds/${task.id}/${file.name}`);
          storageRef.put(file).then(snapshot => {
            snapshot.ref.getDownloadURL().then(url => {
              this.db.collection('tasks').doc(task.id).update({ backgroundUrl: url });
            });
          });
        },
        // è¯·æ±‚é€šçŸ¥æƒé™
        requestNotificationPermission() {
          if ('Notification' in window) {
            Notification.requestPermission().then(permission => {
              if (permission === 'granted') {
                console.log('é€šçŸ¥æƒé™å·²æˆäºˆã€‚');
              }
            });
          }
        },
        // ç®€å• AI æ¨èï¼ˆæ ¹æ®å½“å‰ä»»åŠ¡æ•°æ®ç»™å‡ºå»ºè®®ï¼‰
        getTaskRecommendation() {
          if (this.tasks.length === 0) return "å½“å‰æ²¡æœ‰ä»»åŠ¡ï¼Œå¿«æ·»åŠ ä¸€äº›å§ï¼";
          const categoryCounts = {};
          this.tasks.forEach(task => {
            if (!task.completed) {
              categoryCounts[task.category] = (categoryCounts[task.category] || 0) + 1;
            }
          });
          let minCategory = null;
          let minCount = Infinity;
          for (const [cat, count] of Object.entries(categoryCounts)) {
            if (count < minCount) {
              minCategory = cat;
              minCount = count;
            }
          }
          return minCategory ? `è¯•è¯•å¢åŠ ã€Œ${minCategory}ã€ç±»ä»»åŠ¡å“¦~` : "ä¿æŒè‰¯å¥½ä¹ æƒ¯ï¼ŒåŠ æ²¹ï¼";
        },
        // æ£€æŸ¥ç§¯åˆ†å¥–åŠ±ï¼Œå¹¶è§¦å‘å¥–åŠ±åŠ¨ç”»
        checkRewards(points) {
          if (points % 10 === 0) {
            this.showConfettiAnimation();
            this.unlockedReward = `ğŸ æ­å–œç´¯è®¡ ${points} åˆ†ï¼Œå¥–åŠ±å·²è§£é”ï¼`;
            setTimeout(() => { this.unlockedReward = null; }, 5000);
          }
        },
        // ç®€å• confetti åŠ¨ç”»
        showConfettiAnimation() {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          document.body.appendChild(confetti);
          setTimeout(() => { document.body.removeChild(confetti); }, 3000);
        }
      },
      computed: {
        taskRecommendation() {
          return this.getTaskRecommendation();
        }
      },
      mounted() {
        // åˆå§‹åŒ– Firebaseï¼šè¯·æ›¿æ¢ä¸ºè‡ªå·±çš„é…ç½®
        const firebaseConfig = {
          apiKey: "<YOUR_API_KEY>",
          authDomain: "<YOUR_PROJECT_ID>.firebaseapp.com",
          projectId: "<YOUR_PROJECT_ID>",
          storageBucket: "<YOUR_PROJECT_ID>.appspot.com",
          messagingSenderId: "<YOUR_MESSAGING_SENDER_ID>",
          appId: "<YOUR_APP_ID>"
        };
        firebase.initializeApp(firebaseConfig);
        this.db = firebase.firestore();
        this.storage = firebase.storage();

        // è¯·æ±‚é€šçŸ¥æƒé™
        this.requestNotificationPermission();

        // ç›‘å¬ Firestore tasks é›†åˆï¼Œå®ç°å®æ—¶åŒæ­¥
        this.db.collection('tasks').orderBy('dueDate').onSnapshot(snapshot => {
          this.tasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        });

        // åˆå§‹åŒ–æƒ…ä¾£ç§¯åˆ†ï¼ˆè¯»å– meta/points æ–‡æ¡£ï¼‰
        this.db.collection('meta').doc('points').get().then(doc => {
          if (doc.exists) {
            this.totalPoints = doc.data().value;
          }
        });

        // è·å–æ»¡å±é›¨å®¹å™¨
        this.effectRainEl = this.$refs.effectRain;
      }
    }).mount('#app');
  </script>
</body>
</html>
