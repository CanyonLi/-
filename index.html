<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ±ğŸ£ å°çŒ«å¯¿å¸æ‰«é›· ğŸ£ğŸ±</title>
  <style>
    /* æ•´ä½“èƒŒæ™¯ä¸æ’ç‰ˆ */
    body {
      margin: 0;
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #f6d365, #fda085);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #2c3e50;
    }
    header {
      text-align: center;
      padding: 10px 20px;
    }
    header h1 {
      margin: 0;
      font-size: 2rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    header p {
      margin: 5px 0 0;
      font-size: 1rem;
    }
    /* æ§åˆ¶åŒºï¼šåŒ…å«éš¾åº¦é€‰æ‹©ã€å¼€å§‹ã€æ’è¡Œæ¦œã€è‡ªå®šä¹‰ç­‰ */
    #game-controls {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      padding: 10px 15px;
      margin: 10px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    #game-controls select,
    #game-controls button {
      padding: 6px 10px;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #game-controls select {
      background: #ecf0f1;
      color: #2c3e50;
    }
    #game-controls button {
      background: #81c784;
      color: #fff;
    }
    #game-controls button:hover {
      background: #66bb6a;
    }
    #game-controls div {
      font-size: 1rem;
      margin-top: 5px;
    }
    /* æ¸¸æˆåŒºåŸŸ */
    #board {
      display: grid;
      margin: 10px 0;
      /* æ£‹ç›˜å®½é«˜å°†åœ¨ JS ä¸­æ ¹æ®åˆ—æ•°/è¡Œæ•°è®¾ç½® */
      border: 4px solid #2c3e50;
      background: #ecf0f1;
    }
    .cell {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #bdc3c7;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
      user-select: none;
      font-weight: bold;
    }
    .cell:hover {
      transform: scale(1.1);
      background-color: #dcedc1;
    }
    .cell.revealed {
      background-color: #f7f7f7;
      cursor: default;
    }
    .cell.flag {
      background-color: #ffe0b2;
    }
    .cell.mine {
      background-color: #e57373;
    }
    .cell.number {
      background-color: #f7f7f7;
    }
    /* æ•°å­—é¢œè‰²ï¼šä»¿ç»å…¸æ‰«é›· */
    .num-1 { color: blue; }
    .num-2 { color: green; }
    .num-3 { color: red; }
    .num-4 { color: darkblue; }
    .num-5 { color: maroon; }
    .num-6 { color: teal; }
    .num-7 { color: black; }
    .num-8 { color: gray; }
    /* å¸®åŠ©æç¤º */
    #help {
      background: rgba(255, 255, 255, 0.8);
      padding: 8px 12px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      font-size: 0.9rem;
      text-align: center;
      margin-bottom: 10px;
    }
    /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
    @media (max-width: 600px) {
      .cell { width: 18px; height: 18px; font-size: 0.8rem; }
      header h1 { font-size: 1.5rem; }
      #game-controls select, 
      #game-controls button { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ±ğŸ£ å°çŒ«å¯¿å¸æ‰«é›· ğŸ£ğŸ±</h1>
    <p>ä½“éªŒçŒ«å’ªä¸å¯¿å¸çš„å¥‡å¦™ç»„åˆï¼</p>
  </header>
  <div id="game-controls">
    <select id="difficulty">
      <option value="0">åˆçº§ (9x9, 10 å¯¿å¸)</option>
      <option value="1">ä¸­çº§ (16x16, 40 å¯¿å¸)</option>
      <option value="2">é«˜çº§ (16x30, 99 å¯¿å¸)</option>
    </select>
    <button id="start-button">å¼€å§‹/é‡ç½®æ¸¸æˆ</button>
    <button id="custom-button">è‡ªå®šä¹‰æ¨¡å¼</button>
    <button id="record-button">æ’è¡Œæ¦œ</button>
    <div>
      <span>å‰©ä½™å¯¿å¸æ•°: <span id="mine-counter">0</span></span>
      &nbsp;&nbsp;&nbsp;
      <span>è®¡æ—¶: <span id="timer">0:0</span></span>
    </div>
  </div>
  <div id="board"></div>
  <div id="help">
    <p>æç¤ºï¼šå·¦é”®ç‚¹å‡»ç¿»å¼€æ ¼å­ï¼›å³é”®æˆ–é•¿æŒ‰æ’æ——ï¼ˆç§»åŠ¨ç«¯æ”¯æŒï¼‰ï¼›ç©ºæ ¼é”®æˆ–ç‚¹å‡»â€œå¼€å§‹/é‡ç½®æ¸¸æˆâ€é‡ç½®ã€‚</p>
  </div>
  <!-- å¯é€‰éŸ³æ•ˆï¼ˆéœ€æä¾›å¯¹åº”éŸ³é¢‘æ–‡ä»¶ï¼‰ -->
  <audio id="sound-click" src="click.mp3" preload="auto"></audio>
  <audio id="sound-explosion" src="explosion.mp3" preload="auto"></audio>
  <script>
    // å…¨å±€å˜é‡ä¸å¸¸é‡
    let boardElement = document.getElementById('board');
    let difficultySelect = document.getElementById('difficulty');
    let startButton = document.getElementById('start-button');
    let customButton = document.getElementById('custom-button');
    let recordButton = document.getElementById('record-button');
    let mineCounterElement = document.getElementById('mine-counter');
    let timerElement = document.getElementById('timer');
    let timerInterval = null;
    let timeCount = 0;
    
    let rows, cols, mineCount;
    let board = [];    // äºŒç»´æ•°ç»„å­˜å‚¨æ¯ä¸ªæ ¼å­çš„ DOM å…ƒç´ 
    let mineMap = [];  // äºŒç»´æ•°ç»„å­˜å‚¨é›·åŒºæ•°æ®ï¼Œ'*'è¡¨ç¤ºé›·ï¼Œå…¶å®ƒæ•°å­—è¡¨ç¤ºå‘¨å›´é›·æ•°
    let revealedCount = 0;
    let gameOver = false;
    const directions = [
      [-1,-1], [-1,0], [-1,1],
      [0,-1],          [0,1],
      [1,-1],  [1,0],  [1,1]
    ];
    
    // æ ¹æ®éš¾åº¦è®¾ç½®è¡Œæ•°ã€åˆ—æ•°åŠå¯¿å¸æ•°ï¼ˆå³é›·æ•°ï¼‰
    function setDifficulty(level) {
      switch (parseInt(level)) {
        case 0:
          rows = 9; cols = 9; mineCount = 10;
          break;
        case 1:
          rows = 16; cols = 16; mineCount = 40;
          break;
        case 2:
          rows = 16; cols = 30; mineCount = 99;
          break;
        default:
          rows = 9; cols = 9; mineCount = 10;
      }
      mineCounterElement.textContent = mineCount;
    }
    
    // å¯åŠ¨è®¡æ—¶å™¨
    function startTimer() {
      clearInterval(timerInterval);
      timeCount = 0;
      timerElement.textContent = "0:0";
      timerInterval = setInterval(() => {
        timeCount++;
        let minutes = Math.floor(timeCount / 60);
        let seconds = timeCount % 60;
        timerElement.textContent = minutes + ":" + seconds;
      }, 1000);
    }
    
    // åœæ­¢è®¡æ—¶å™¨
    function stopTimer() {
      clearInterval(timerInterval);
    }
    
    // é‡ç½®æ¸¸æˆï¼šåˆå§‹åŒ–æ£‹ç›˜ã€æ•°æ®ã€è®¡æ—¶å™¨
    function resetGame() {
      stopTimer();
      boardElement.innerHTML = "";
      board = [];
      mineMap = [];
      revealedCount = 0;
      gameOver = false;
      setDifficulty(difficultySelect.value);
      // æ ¹æ®åˆ—æ•°è®¾ç½®æ£‹ç›˜å®½é«˜ï¼ˆæ¯ä¸ªæ ¼å­22pxå«è¾¹æ¡†é—´éš™ï¼‰
      boardElement.style.width = (cols * 22) + "px";
      boardElement.style.height = (rows * 22) + "px";
      boardElement.style.gridTemplateColumns = `repeat(${cols}, 20px)`;
      boardElement.style.gridTemplateRows = `repeat(${rows}, 20px)`;
      
      // åˆ›å»ºæ£‹ç›˜
      for (let r = 0; r < rows; r++) {
        board[r] = [];
        mineMap[r] = [];
        for (let c = 0; c < cols; c++) {
          let cell = document.createElement('div');
          cell.classList.add('cell');
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.addEventListener('click', cellClick);
          cell.addEventListener('contextmenu', cellRightClick);
          // ç§»åŠ¨ç«¯ï¼šé•¿æŒ‰æ ‡è®°
          let touchTimer = null;
          cell.addEventListener('touchstart', (e) => {
            if (gameOver) return;
            touchTimer = setTimeout(() => {
              cellRightClick(e);
            }, 600);
          });
          cell.addEventListener('touchend', (e) => {
            clearTimeout(touchTimer);
          });
          boardElement.appendChild(cell);
          board[r][c] = cell;
          mineMap[r][c] = 0;
        }
      }
    }
    
    // ç”Ÿæˆé›·åŒºï¼ˆä¿è¯é¦–æ¬¡ç‚¹å‡»å®‰å…¨ï¼‰
    function generateMines(firstRow, firstCol) {
      let placed = 0;
      while (placed < mineCount) {
        let r = Math.floor(Math.random() * rows);
        let c = Math.floor(Math.random() * cols);
        if ((r === firstRow && c === firstCol) || mineMap[r][c] === '*') continue;
        mineMap[r][c] = '*';
        placed++;
      }
      // æ ¹æ®é›·åŒºç”Ÿæˆæ•°å­—æç¤º
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          if (mineMap[r][c] === '*') continue;
          let count = 0;
          for (let [dr, dc] of directions) {
            let nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && mineMap[nr][nc] === '*') {
              count++;
            }
          }
          mineMap[r][c] = count;
        }
      }
    }
    
    // è¿”å›ä¸ä¸»é¢˜ç›¸å…³çš„é›· emojiï¼ˆä»…ä½¿ç”¨çŒ«å’Œå¯¿å¸ï¼‰
    function getMineEmoji() {
      return Math.random() > 0.5 ? "ğŸ±" : "ğŸ£";
    }
    
    // æ ¹æ®æ•°å­—è¿”å›å¯¹åº”é¢œè‰²çš„ class åï¼ˆä»¿æ‰«é›·ç»å…¸ï¼‰
    function getNumberClass(num) {
      switch (num) {
        case 1: return "num-1";
        case 2: return "num-2";
        case 3: return "num-3";
        case 4: return "num-4";
        case 5: return "num-5";
        case 6: return "num-6";
        case 7: return "num-7";
        case 8: return "num-8";
        default: return "";
      }
    }
    
    // å·¦é”®ç‚¹å‡»ï¼šç¿»å¼€æ ¼å­
    function cellClick(e) {
      if (gameOver) return;
      let cell = e.currentTarget;
      let r = parseInt(cell.dataset.row);
      let c = parseInt(cell.dataset.col);
      if (revealedCount === 0) {
        generateMines(r, c);
        startTimer();
      }
      if (cell.classList.contains('flag')) return;
      revealCell(r, c);
      checkWin();
    }
    
    // å³é”®ç‚¹å‡»æˆ–é•¿æŒ‰ï¼šæ ‡è®°/å–æ¶ˆæ ‡è®°
    function cellRightClick(e) {
      e.preventDefault();
      if (gameOver) return;
      let cell = e.currentTarget;
      if (cell.classList.contains('revealed')) return;
      if (cell.classList.contains('flag')) {
        cell.classList.remove('flag');
        cell.textContent = "";
        mineCounterElement.textContent = parseInt(mineCounterElement.textContent) + 1;
      } else {
        cell.classList.add('flag');
        cell.textContent = "ğŸ¾"; // ä½¿ç”¨å¯çˆ±çš„çˆªå°ä½œä¸ºæ——å¸œ
        mineCounterElement.textContent = parseInt(mineCounterElement.textContent) - 1;
      }
    }
    
    // ç¿»å¼€æ ¼å­ï¼ˆé€’å½’å±•å¼€ç©ºç™½åŒºåŸŸï¼‰
    function revealCell(r, c) {
      if (r < 0 || r >= rows || c < 0 || c >= cols) return;
      let cell = board[r][c];
      if (cell.classList.contains('revealed') || cell.classList.contains('flag')) return;
      cell.classList.add('revealed');
      revealedCount++;
      // å¯é€‰ï¼šæ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
      // document.getElementById('sound-click').play();
      if (mineMap[r][c] === '*') {
        cell.classList.add('mine');
        cell.textContent = getMineEmoji();
        gameOverFn(false);
      } else if (mineMap[r][c] > 0) {
        cell.classList.add('number');
        cell.textContent = mineMap[r][c];
        cell.classList.add(getNumberClass(mineMap[r][c]));
      } else {
        // ç©ºç™½åŒºåŸŸï¼Œé€’å½’å±•å¼€ç›¸é‚»æ ¼å­
        for (let [dr, dc] of directions) {
          revealCell(r + dr, c + dc);
        }
      }
    }
    
    // æ¸¸æˆç»“æŸï¼šæ˜¾ç¤ºæ‰€æœ‰é›·ã€ç¦ç”¨äº¤äº’ã€å¼¹çª—æç¤º
    function gameOverFn(win) {
      gameOver = true;
      stopTimer();
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          let cell = board[r][c];
          if (mineMap[r][c] === '*' && !cell.classList.contains('revealed')) {
            cell.classList.add('mine');
            cell.textContent = getMineEmoji();
          }
          cell.removeEventListener('click', cellClick);
          cell.removeEventListener('contextmenu', cellRightClick);
        }
      }
      // å¯é€‰ï¼šæ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆ
      // document.getElementById('sound-explosion').play();
      setTimeout(() => {
        alert(win ? "æ­å–œä½ ï¼ä½ èµ¢äº†ï¼" : "æ¸¸æˆå¤±è´¥ï¼");
      }, 200);
    }
    
    // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
    function checkWin() {
      if (revealedCount === rows * cols - mineCount) {
        gameOverFn(true);
      }
    }
    
    // è‡ªå®šä¹‰æ¨¡å¼ï¼šå¼¹å‡ºè¾“å…¥æç¤ºï¼Œå…è®¸ç©å®¶è®¾ç½®è¡Œæ•°ã€åˆ—æ•°å’Œé›·æ•°
    customButton.addEventListener('click', () => {
      let customRows = parseInt(prompt("è¯·è¾“å…¥è¡Œæ•° (å»ºè®®èŒƒå›´: 5-30):", "16"));
      let customCols = parseInt(prompt("è¯·è¾“å…¥åˆ—æ•° (å»ºè®®èŒƒå›´: 5-50):", "30"));
      let customMines = parseInt(prompt("è¯·è¾“å…¥å¯¿å¸æ•° (å»ºè®®èŒƒå›´: 5 è‡³ è¡Œæ•°Ã—åˆ—æ•°-1):", "99"));
      if (customRows && customCols && customMines && customMines < customRows * customCols) {
        rows = customRows;
        cols = customCols;
        mineCount = customMines;
        mineCounterElement.textContent = mineCount;
        resetGame();
      } else {
        alert("è¾“å…¥ä¸åˆæ³•ï¼Œè¯·é‡è¯•ï¼");
      }
    });
    
    // æ’è¡Œæ¦œæŒ‰é’®ï¼ˆç›®å‰ä¸ºå ä½åŠŸèƒ½ï¼‰
    recordButton.addEventListener('click', () => {
      alert("æ’è¡Œæ¦œåŠŸèƒ½å¾…å¼€å‘ï¼");
    });
    
    // å¼€å§‹/é‡ç½®æŒ‰é’®ä¸ç©ºæ ¼é”®ç»‘å®šé‡ç½®æ¸¸æˆ
    startButton.addEventListener('click', resetGame);
    window.addEventListener('keydown', (e) => {
      if (e.key === ' ' && !gameOver) {
        e.preventDefault();
        resetGame();
      }
    });
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
    window.addEventListener('load', resetGame);
  </script>
</body>
</html>
